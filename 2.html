<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>é™€èºä»ªç”Ÿæ—¥é€‰æ‹©å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #3a7bd5 0%, #00d2ff 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: hidden;
            touch-action: none;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 400px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-bottom: 25px;
        }

        .date-display {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            color: white;
        }

        .date-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .date-value {
            font-size: 32px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .date-detail {
            font-size: 14px;
            margin-top: 8px;
            opacity: 0.9;
        }

        .plane-container {
            position: relative;
            width: 100%;
            aspect-ratio: 1;
            margin: 20px 0;
            background: linear-gradient(to bottom, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .grid-lines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .grid-line-h, .grid-line-v {
            position: absolute;
            background: rgba(0, 0, 0, 0.05);
        }

        .grid-line-h {
            width: 100%;
            height: 1px;
        }

        .grid-line-v {
            height: 100%;
            width: 1px;
        }

        .axis-labels {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .label {
            position: absolute;
            font-size: 10px;
            color: #666;
            font-weight: 500;
        }

        .label-x {
            bottom: 5px;
            transform: translateX(-50%);
        }

        .label-y {
            left: 5px;
            transform: translateY(-50%);
        }

        .slider-thumb {
            position: absolute;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 10;
            transform: translate(-50%, -50%);
            transition: box-shadow 0.3s;
        }

        .slider-thumb::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .slider-thumb.active {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.8);
            animation: pulse-thumb 1.5s ease-in-out infinite;
        }

        @keyframes pulse-thumb {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        .coordinates {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .coordinate-item {
            text-align: center;
            flex: 1;
        }

        .coordinate-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .coordinate-value {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            font-family: 'Courier New', monospace;
        }

        .status {
            text-align: center;
            margin: 15px 0;
            padding: 12px;
            border-radius: 10px;
            font-size: 14px;
            background: #e7f3ff;
            color: #0066cc;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .button:active {
            transform: scale(0.98);
        }

        .confirm-button {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            color: white;
        }

        .reset-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .permission-prompt {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .permission-box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 350px;
        }

        .permission-box h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .permission-box p {
            margin-bottom: 25px;
            color: #666;
            line-height: 1.6;
        }

        .permission-button {
            padding: 12px 30px;
            background: linear-gradient(135deg, #3a7bd5 0%, #00d2ff 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        .gyro-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .success-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }

        .success-overlay.show {
            display: flex;
        }

        .success-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 350px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .success-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .success-box h2 {
            color: #56ab2f;
            margin-bottom: 20px;
        }

        .success-date {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }

        .close-button {
            margin-top: 25px;
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="permission-prompt" id="permissionPrompt">
        <div class="permission-box">
            <div class="gyro-icon">ğŸ‚</div>
            <h2>é™€èºä»ªç”Ÿæ—¥é€‰æ‹©å™¨</h2>
            <p>å€¾æ–œæ‰‹æœºæ¥é€‰æ‹©æ‚¨çš„å‡ºç”Ÿæ—¥æœŸ<br>å·¦å³å€¾æ–œé€‰æ‹©å¹´ä»½<br>å‰åå€¾æ–œé€‰æ‹©æ—¥æœŸ</p>
            <button class="permission-button" id="requestPermission">å¼€å§‹é€‰æ‹©</button>
        </div>
    </div>

    <div class="success-overlay" id="successOverlay">
        <div class="success-box">
            <div class="success-icon">ğŸ‰</div>
            <h2>ç”Ÿæ—¥å·²ç¡®è®¤</h2>
            <div class="success-date" id="successDate"></div>
            <p id="successDetail"></p>
            <button class="close-button" id="closeSuccess">å…³é—­</button>
        </div>
    </div>

    <div class="container">
        <h1>é€‰æ‹©æ‚¨çš„ç”Ÿæ—¥</h1>
        <div class="subtitle">å€¾æ–œæ‰‹æœºæ§åˆ¶æ»‘å—</div>

        <div class="date-display">
            <div class="date-label">å½“å‰é€‰æ‹©</div>
            <div class="date-value" id="dateValue">2000-01-01</div>
            <div class="date-detail" id="dateDetail">æ˜ŸæœŸå…­</div>
        </div>

        <div class="plane-container" id="planeContainer">
            <div class="grid-lines" id="gridLines"></div>
            <div class="axis-labels" id="axisLabels"></div>
            <div class="slider-thumb active" id="sliderThumb"></div>
        </div>

        <div class="coordinates">
            <div class="coordinate-item">
                <div class="coordinate-label">å¹´ä»½</div>
                <div class="coordinate-value" id="yearValue">2000</div>
            </div>
            <div class="coordinate-item">
                <div class="coordinate-label">æœˆä»½</div>
                <div class="coordinate-value" id="monthValue">1æœˆ</div>
            </div>
            <div class="coordinate-item">
                <div class="coordinate-label">æ—¥æœŸ</div>
                <div class="coordinate-value" id="dayValue">1æ—¥</div>
            </div>
        </div>

        <div class="status" id="status">
            å€¾æ–œæ‰‹æœºæ¥é€‰æ‹©æ—¥æœŸ
        </div>

        <div class="button-group">
            <button class="confirm-button" id="confirmButton">âœ“ ç¡®è®¤ç”Ÿæ—¥</button>
            <button class="reset-button" id="resetButton">â†º é‡ç½®</button>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentX = 0.5; // 0-1ï¼Œå¯¹åº”å¹´ä»½
        let currentY = 0.5; // 0-1ï¼Œå¯¹åº”ä¸€å¹´ä¸­çš„å¤©æ•°
        let velocityX = 0;
        let velocityY = 0;
        let isGyroActive = false;
        let lastGamma = 0;
        let lastBeta = 0;

        // å¹´ä»½èŒƒå›´ï¼ˆæœ€è¿‘80å¹´ï¼‰
        const currentYear = new Date().getFullYear();
        const minYear = currentYear - 79;
        const maxYear = currentYear;
        const yearRange = maxYear - minYear;

        // ç‰©ç†å‚æ•°
        const friction = 0.93;
        const sensitivity = 0.0006;
        const maxVelocity = 0.015;

        // DOM å…ƒç´ 
        const dateValueEl = document.getElementById('dateValue');
        const dateDetailEl = document.getElementById('dateDetail');
        const yearValueEl = document.getElementById('yearValue');
        const monthValueEl = document.getElementById('monthValue');
        const dayValueEl = document.getElementById('dayValue');
        const sliderThumb = document.getElementById('sliderThumb');
        const statusEl = document.getElementById('status');
        const planeContainer = document.getElementById('planeContainer');
        const gridLines = document.getElementById('gridLines');
        const axisLabels = document.getElementById('axisLabels');
        const confirmButton = document.getElementById('confirmButton');
        const resetButton = document.getElementById('resetButton');
        const permissionPrompt = document.getElementById('permissionPrompt');
        const requestPermissionBtn = document.getElementById('requestPermission');
        const successOverlay = document.getElementById('successOverlay');
        const successDate = document.getElementById('successDate');
        const successDetail = document.getElementById('successDetail');
        const closeSuccessBtn = document.getElementById('closeSuccess');

        // æ˜ŸæœŸåç§°
        const weekDays = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
        const monthNames = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];

        // åˆå§‹åŒ–
        function init() {
            createGrid();
            createAxisLabels();
            updateDisplay();
            animate();
        }

        // åˆ›å»ºç½‘æ ¼çº¿
        function createGrid() {
            // åˆ›å»º10æ¡æ¨ªçº¿
            for (let i = 0; i <= 10; i++) {
                const line = document.createElement('div');
                line.className = 'grid-line-h';
                line.style.top = (i * 10) + '%';
                gridLines.appendChild(line);
            }

            // åˆ›å»º10æ¡ç«–çº¿
            for (let i = 0; i <= 10; i++) {
                const line = document.createElement('div');
                line.className = 'grid-line-v';
                line.style.left = (i * 10) + '%';
                gridLines.appendChild(line);
            }
        }

        // åˆ›å»ºåæ ‡è½´æ ‡ç­¾
        function createAxisLabels() {
            // Xè½´æ ‡ç­¾ï¼ˆå¹´ä»½ï¼‰ - æ˜¾ç¤º5ä¸ªæ ‡ç­¾
            for (let i = 0; i <= 4; i++) {
                const label = document.createElement('div');
                label.className = 'label label-x';
                const year = minYear + Math.floor(yearRange * i / 4);
                label.textContent = year;
                label.style.left = (i * 25) + '%';
                axisLabels.appendChild(label);
            }

            // Yè½´æ ‡ç­¾ï¼ˆæœˆä»½ï¼‰ - æ˜¾ç¤º12ä¸ªæœˆ
            for (let i = 0; i <= 11; i++) {
                const label = document.createElement('div');
                label.className = 'label label-y';
                label.textContent = (i + 1) + 'æœˆ';
                label.style.top = (i * 100 / 11) + '%';
                axisLabels.appendChild(label);
            }
        }

        // å°†ä¸€å¹´ä¸­çš„ç¬¬Nå¤©è½¬æ¢ä¸ºæ—¥æœŸ
        function dayOfYearToDate(year, dayOfYear) {
            // ç¡®ä¿dayOfYearåœ¨æœ‰æ•ˆèŒƒå›´å†…
            const isLeapYear = (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
            const maxDays = isLeapYear ? 366 : 365;
            dayOfYear = Math.max(1, Math.min(maxDays, Math.round(dayOfYear)));

            const date = new Date(year, 0);
            date.setDate(dayOfYear);
            return date;
        }

        // è·å–å½“å‰é€‰æ‹©çš„æ—¥æœŸ
        function getCurrentDate() {
            const year = Math.round(minYear + currentX * yearRange);
            const isLeapYear = (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
            const maxDays = isLeapYear ? 366 : 365;
            const dayOfYear = Math.round(1 + currentY * (maxDays - 1));
            
            return dayOfYearToDate(year, dayOfYear);
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            const date = getCurrentDate();
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const weekDay = weekDays[date.getDay()];

            // æ ¼å¼åŒ–æ—¥æœŸ
            const dateString = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            dateValueEl.textContent = dateString;
            dateDetailEl.textContent = weekDay;

            // æ›´æ–°åæ ‡å€¼
            yearValueEl.textContent = year;
            monthValueEl.textContent = month + 'æœˆ';
            dayValueEl.textContent = day + 'æ—¥';

            // æ›´æ–°æ»‘å—ä½ç½®
            sliderThumb.style.left = (currentX * 100) + '%';
            sliderThumb.style.top = (currentY * 100) + '%';
        }

        // è¯·æ±‚é™€èºä»ªæƒé™
        async function requestGyroscopePermission() {
            try {
                if (typeof DeviceOrientationEvent !== 'undefined' && 
                    typeof DeviceOrientationEvent.requestPermission === 'function') {
                    const permission = await DeviceOrientationEvent.requestPermission();
                    if (permission === 'granted') {
                        startGyroscope();
                    } else {
                        alert('éœ€è¦é™€èºä»ªæƒé™æ‰èƒ½ç»§ç»­');
                    }
                } else {
                    startGyroscope();
                }
            } catch (error) {
                console.error('è¯·æ±‚é™€èºä»ªæƒé™å¤±è´¥:', error);
                alert('æ— æ³•è®¿é—®é™€èºä»ªï¼Œè¯·ç¡®ä¿ä½¿ç”¨HTTPSè¿æ¥æˆ–åœ¨æ‰‹æœºä¸Šæ‰“å¼€');
            }
        }

        // å¼€å§‹é™€èºä»ªç›‘å¬
        function startGyroscope() {
            permissionPrompt.style.display = 'none';
            isGyroActive = true;
            
            window.addEventListener('deviceorientation', handleOrientation);
            
            statusEl.textContent = 'å€¾æ–œæ‰‹æœºæ¥é€‰æ‹©æ‚¨çš„ç”Ÿæ—¥';
        }

        // å¤„ç†è®¾å¤‡æ–¹å‘äº‹ä»¶
        function handleOrientation(event) {
            if (!isGyroActive) return;

            let gamma = event.gamma; // å·¦å³å€¾æ–œ (-90 åˆ° 90)
            let beta = event.beta;   // å‰åå€¾æ–œ (-180 åˆ° 180)

            if (gamma === null || beta === null) return;

            lastGamma = gamma;
            lastBeta = beta;

            // é™åˆ¶è§’åº¦èŒƒå›´
            gamma = Math.max(-45, Math.min(45, gamma));
            beta = Math.max(-45, Math.min(45, beta));

            // æ ¹æ®å€¾æ–œè§’åº¦è®¡ç®—åŠ é€Ÿåº¦
            const accelerationX = gamma * sensitivity;
            const accelerationY = beta * sensitivity;
            
            // æ›´æ–°é€Ÿåº¦ï¼ˆå¸¦æƒ¯æ€§ï¼‰
            velocityX += accelerationX;
            velocityX = Math.max(-maxVelocity, Math.min(maxVelocity, velocityX));

            velocityY += accelerationY;
            velocityY = Math.max(-maxVelocity, Math.min(maxVelocity, velocityY));
        }

        // åŠ¨ç”»å¾ªç¯
        function animate() {
            // åº”ç”¨é€Ÿåº¦åˆ°ä½ç½®
            currentX += velocityX;
            currentY += velocityY;
            
            // é™åˆ¶ä½ç½®åœ¨0-1ä¹‹é—´ï¼Œå¸¦è¾¹ç•Œåå¼¹
            if (currentX < 0) {
                currentX = 0;
                velocityX = -velocityX * 0.5;
            } else if (currentX > 1) {
                currentX = 1;
                velocityX = -velocityX * 0.5;
            }
            
            if (currentY < 0) {
                currentY = 0;
                velocityY = -velocityY * 0.5;
            } else if (currentY > 1) {
                currentY = 1;
                velocityY = -velocityY * 0.5;
            }
            
            // åº”ç”¨æ‘©æ“¦åŠ›
            velocityX *= friction;
            velocityY *= friction;

            updateDisplay();
            requestAnimationFrame(animate);
        }

        // ç¡®è®¤ç”Ÿæ—¥
        function confirmBirthday() {
            const date = getCurrentDate();
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const weekDay = weekDays[date.getDay()];
            const dateString = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;

            // è®¡ç®—å¹´é¾„
            const today = new Date();
            let age = today.getFullYear() - year;
            const monthDiff = today.getMonth() - date.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < day)) {
                age--;
            }

            successDate.textContent = dateString;
            successDetail.textContent = `${weekDay} Â· ${age >= 0 ? age + ' å²' : 'æœªæ¥æ—¥æœŸ'}`;
            successOverlay.classList.add('show');

            // åœæ­¢é™€èºä»ª
            isGyroActive = false;
        }

        // é‡ç½®
        function reset() {
            currentX = 0.5;
            currentY = 0.5;
            velocityX = 0;
            velocityY = 0;
            updateDisplay();
            
            if (permissionPrompt.style.display === 'none') {
                isGyroActive = true;
                statusEl.textContent = 'å€¾æ–œæ‰‹æœºæ¥é€‰æ‹©æ‚¨çš„ç”Ÿæ—¥';
            }
        }

        // å…³é—­æˆåŠŸæç¤º
        function closeSuccess() {
            successOverlay.classList.remove('show');
            isGyroActive = true;
        }

        // äº‹ä»¶ç›‘å¬
        requestPermissionBtn.addEventListener('click', requestGyroscopePermission);
        confirmButton.addEventListener('click', confirmBirthday);
        resetButton.addEventListener('click', reset);
        closeSuccessBtn.addEventListener('click', closeSuccess);

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        init();

        // é˜²æ­¢é¡µé¢æ»šåŠ¨
        document.body.addEventListener('touchmove', function(e) {
            e.preventDefault();
        }, { passive: false });
    </script>
</body>
</html>
